<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Lavanda Fit ‚Äî –ø–æ—Ö—É–¥–µ–Ω–∏–µ —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    :root {
      --bg-main: #120821;
      --bg-gradient: radial-gradient(circle at top, #5f31d6 0, #120821 55%, #080312 100%);
      --card-bg: rgba(32, 17, 64, 0.9);
      --card-bg-soft: rgba(45, 27, 80, 0.9);
      --accent: #c084fc;
      --accent-soft: #e9d5ff;
      --accent-contrast: #fdf4ff;
      --text-main: #fef9ff;
      --text-muted: #c4b5fd;
      --border-soft: rgba(255, 255, 255, 0.12);
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.6);
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --transition-fast: 0.2s ease-out;
      --transition-normal: 0.3s ease-out;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Roboto", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app-shell {
      position: relative;
      width: 100%;
      max-width: 480px;
      min-height: 100vh;
      padding-bottom: 76px;
      overflow: hidden;
    }

    .app-inner { padding: 16px 14px 90px; }

    header.app-header {
      padding: 6px 4px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .app-title-block { display: flex; flex-direction: column; gap: 2px; }

    .app-title {
      letter-spacing: 0.03em;
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(120deg, #fdf4ff, #c4b5fd, #f9a8ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .app-subtitle { font-size: 12px; color: var(--text-muted); }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(244, 219, 255, 0.12), rgba(35, 18, 70, 0.96));
      border: 1px solid rgba(226, 216, 255, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--accent-soft);
      backdrop-filter: blur(18px);
    }

    .chip-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, #f97316 0, #c2410c 60%, transparent 100%);
      box-shadow: 0 0 8px rgba(248, 153, 86, 0.8);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 14px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(24px);
    }
    .card + .card { margin-top: 14px; }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .card-title { font-size: 15px; font-weight: 600; }
    .card-subtitle { font-size: 11px; color: var(--text-muted); }

    .profile-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .field { display: flex; flex-direction: column; gap: 4px; }
    .field label { font-size: 11px; color: var(--text-muted); }

    .field input,
    .field select {
      background: rgba(20, 12, 46, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(148, 131, 244, 0.5);
      padding: 6px 10px;
      font-size: 13px;
      color: var(--text-main);
      outline: none;
      width: 100%;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(192, 132, 252, 0.6);
    }

    .inline-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(24, 16, 63, 0.9);
      border: 1px solid rgba(213, 180, 255, 0.5);
      font-size: 11px;
      color: var(--accent-soft);
    }
    .inline-pill strong { color: var(--accent-contrast); font-weight: 600; }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: var(--radius-pill);
      font-size: 13px;
      padding: 8px 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: var(--accent-contrast);
      background: linear-gradient(120deg, #a855f7, #f472b6);
      box-shadow: 0 12px 26px rgba(120, 53, 220, 0.6);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), opacity var(--transition-fast);
      white-space: nowrap;
    }
    .btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 8px 18px rgba(88, 28, 135, 0.7);
      opacity: 0.9;
    }

    .btn-ghost {
      background: rgba(22, 13, 52, 0.95);
      color: var(--accent-soft);
      border: 1px solid rgba(165, 148, 255, 0.6);
      box-shadow: none;
    }
    .btn-ghost:active { transform: translateY(1px); opacity: 0.85; }

    .btn-sm { padding: 5px 10px; font-size: 12px; }
    .btn-block { width: 100%; justify-content: center; }

    .progress-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 6px;
    }
    .progress-label { font-size: 12px; color: var(--text-muted); }
    .progress-value { font-size: 13px; font-weight: 500; color: var(--accent-soft); }

    .progress {
      position: relative;
      flex: 1;
      height: 9px;
      border-radius: 999px;
      background: rgba(21, 10, 57, 0.95);
      overflow: hidden;
    }
    .progress-fill {
      position: absolute;
      height: 100%;
      left: 0; top: 0;
      width: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, #a855f7, #f9a8ff);
      box-shadow: 0 0 12px rgba(216, 180, 254, 0.8);
      transition: width var(--transition-normal);
    }

    .weight-graph {
      margin-top: 8px;
      padding: 10px 10px 6px;
      background: var(--card-bg-soft);
      border-radius: var(--radius-md);
      border: 1px solid rgba(180, 159, 255, 0.25);
    }

    .weight-layout {
      display: flex;
      gap: 10px;
      align-items: stretch;
      flex-direction: column;
    }
    @media (min-width: 420px) {
      .weight-layout { flex-direction: row; }
    }

    .weight-graph-panel { flex: 1.2; display: flex; flex-direction: column; }
    .weight-data-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: rgba(17, 12, 43, 0.9);
      border-radius: 14px;
      border: 1px solid rgba(191, 175, 255, 0.4);
      padding: 8px 8px 6px;
      font-size: 11px;
    }

    .weight-data-title,
    .weight-history-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .weight-graph-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .weight-graph-title { font-size: 12px; color: var(--text-muted); }
    .weight-graph-value { font-size: 20px; font-weight: 600; color: var(--accent-soft); }
    .weight-graph-value span { font-size: 11px; font-weight: 400; color: var(--text-muted); }

    .weight-chart { display: flex; gap: 6px; align-items: stretch; margin-top: 4px; }

    .weight-y-axis {
      width: 34px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: flex-end;
      padding: 4px 2px 4px 0;
      border-right: 1px solid rgba(129, 140, 248, 0.5);
    }
    .weight-y-axis span {
      font-size: 9px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .weight-chart-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .weight-graph-canvas {
      position: relative;
      height: 120px;
      overflow: hidden;
      border-bottom: 1px solid rgba(129, 140, 248, 0.5);
      padding-bottom: 2px;
    }

    .weight-line-svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .weight-x-axis {
      display: flex;
      gap: 4px;
      margin-top: 2px;
    }
    .weight-x-label {
      flex: 1;
      text-align: center;
      font-size: 8px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .weight-empty {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      padding: 18px 0 8px;
      width: 100%;
    }

    .weight-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .weight-actions .field { flex: 1; }
    .weight-actions .btn-sm { min-width: 100px; }

    .weight-stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }
    .weight-stat-label { font-size: 10px; color: var(--text-muted); }
    .weight-stat-value { font-size: 13px; font-weight: 500; color: var(--accent-soft); }

    .weight-history-title { margin-top: 4px; }
    .weight-history-list {
      max-height: 90px;
      overflow-y: auto;
      margin-top: 2px;
      padding-right: 2px;
    }
    .weight-history-item {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      padding: 2px 0;
      border-bottom: 1px dashed rgba(129, 140, 248, 0.3);
    }
    .weight-history-item:last-child { border-bottom: none; }
    .weight-history-item span:last-child {
      color: var(--accent-soft);
      font-weight: 500;
    }
    .weight-history-empty {
      font-size: 11px;
      color: var(--text-muted);
      padding: 4px 0;
    }

    /* –ó–∞–º–µ—Ä—ã (–æ–±—Ö–≤–∞—Ç—ã) */
    .measure-note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    .measure-history-list {
      margin-top: 8px;
      max-height: 110px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .measure-history-item {
      font-size: 11px;
      padding: 3px 0;
      border-bottom: 1px dashed rgba(129, 140, 248, 0.3);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .measure-history-item:last-child { border-bottom: none; }
    .measure-date {
      color: var(--text-muted);
    }
    .measure-values {
      color: var(--accent-soft);
    }

    .recipes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .recipes-note { font-size: 11px; color: var(--text-muted); }
    .recipes-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 4px;
    }
    .recipe-card {
      background: rgba(32, 16, 73, 0.95);
      border-radius: var(--radius-md);
      border: 1px solid rgba(209, 196, 255, 0.28);
      padding: 10px 10px 9px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }
    .recipe-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 26px rgba(88, 28, 135, 0.8);
      border-color: rgba(243, 232, 255, 0.7);
    }
    .recipe-type {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }
    .recipe-title { font-size: 14px; font-weight: 600; }
    .recipe-meta {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      font-size: 11px;
      color: var(--accent-soft);
    }
    .recipe-macros {
      display: flex;
      gap: 8px;
      font-size: 10px;
      color: var(--text-muted);
    }
    .recipe-tag {
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(22, 163, 74, 0.12);
      color: #bbf7d0;
      border: 1px solid rgba(52, 211, 153, 0.3);
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 100;
    }
    .modal.active { display: flex; }
    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(79, 70, 229, 0.45), rgba(15, 23, 42, 0.9));
      backdrop-filter: blur(18px);
    }
    .modal-content {
      position: relative;
      width: 100%;
      max-width: 480px;
      max-height: 85vh;
      background: radial-gradient(circle at top left, rgba(243, 232, 255, 0.12), rgba(24, 14, 51, 1));
      border-radius: 20px 20px 0 0;
      border: 1px solid rgba(226, 216, 255, 0.55);
      box-shadow: 0 -18px 40px rgba(0, 0, 0, 0.8);
      padding: 14px 16px 18px;
      overflow-y: auto;
      animation: slideUp 0.26s ease-out;
    }

    @keyframes slideUp {
      from { transform: translateY(18px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }
    .modal-title { font-size: 16px; font-weight: 600; }
    .modal-close {
      border: none;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: var(--accent-soft);
      border-radius: 999px;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .modal-section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .ingredients-list,
    .steps-list {
      margin: 0;
      padding-left: 18px;
      font-size: 13px;
      color: var(--accent-soft);
    }
    .ingredients-list li,
    .steps-list li { margin-bottom: 4px; }

    .microlist {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    .micro-card {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      padding: 8px 9px;
      border-radius: var(--radius-md);
      background: rgba(24, 16, 63, 0.9);
      border: 1px solid rgba(209, 196, 255, 0.3);
      font-size: 12px;
    }
    .micro-title { font-weight: 500; margin-bottom: 2px; }
    .micro-meta { font-size: 11px; color: var(--text-muted); }
    .micro-done-toggle {
      border-radius: 999px;
      border: 1px solid rgba(187, 247, 208, 0.6);
      color: #bbf7d0;
      background: rgba(5, 46, 22, 0.16);
      padding: 3px 8px;
      font-size: 10px;
      cursor: pointer;
    }
    .micro-done-toggle.done {
      background: linear-gradient(120deg, #22c55e, #4ade80);
      color: #022c22;
      border-color: transparent;
    }

    .diary-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }
    .diary-form input,
    .diary-form textarea {
      background: rgba(20, 12, 46, 0.95);
      border-radius: 14px;
      border: 1px solid rgba(148, 131, 244, 0.5);
      padding: 7px 10px;
      font-size: 13px;
      color: var(--text-main);
      outline: none;
      resize: vertical;
      min-height: 38px;
    }
    .diary-form textarea { min-height: 70px; }
    .diary-form input::placeholder,
    .diary-form textarea::placeholder {
      color: rgba(167, 139, 250, 0.8);
      font-size: 12px;
    }
    .diary-form input:focus,
    .diary-form textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(192, 132, 252, 0.7);
    }

    .diary-list {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .diary-item {
      padding: 8px 9px;
      border-radius: var(--radius-md);
      background: rgba(24, 16, 63, 0.9);
      border: 1px solid rgba(209, 196, 255, 0.3);
      font-size: 12px;
    }
    .diary-item-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 3px;
    }
    .diary-title { font-weight: 500; }
    .diary-date { font-size: 10px; color: var(--text-muted); }
    .diary-text {
      font-size: 12px;
      color: var(--accent-soft);
      white-space: pre-wrap;
    }

    .bottom-nav-shell {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 10px;
      width: 100%;
      max-width: 480px;
      padding: 0 14px;
      z-index: 50;
      pointer-events: none;
    }
    .bottom-nav {
      pointer-events: auto;
      background: radial-gradient(circle at top, rgba(243, 232, 255, 0.2), rgba(15, 23, 42, 0.98));
      border-radius: 20px;
      padding: 6px 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(209, 196, 255, 0.4);
      backdrop-filter: blur(20px);
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      padding: 4px 0;
      cursor: pointer;
      color: var(--text-muted);
      font-size: 10px;
      border-radius: 999px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }
    .tab-btn-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(165, 148, 255, 0.7);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      background: rgba(17, 24, 39, 0.8);
    }
    .tab-btn.active {
      background: linear-gradient(120deg, #a855f7, #f472b6);
      color: #fdf4ff;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(129, 90, 213, 0.9);
    }
    .tab-btn.active .tab-btn-icon {
      border-color: rgba(250, 250, 255, 0.9);
      background: transparent;
    }

    @media (min-width: 520px) {
      body { padding: 16px 0; }
      .app-shell {
        border-radius: 32px;
        border: 1px solid rgba(148, 131, 244, 0.6);
        box-shadow: 0 40px 80px rgba(15, 23, 42, 0.9);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="app-inner">
      <header class="app-header">
        <div class="app-title-block">
          <div class="app-title">Lavanda Fit</div>
          <div class="app-subtitle">–ü–æ—Ö—É–¥–µ–Ω–∏–µ —Å –∑–∞–±–æ—Ç–æ–π –æ —Å–µ–±–µ</div>
        </div>
        <div class="chip">
          <span class="chip-dot"></span>
          <span>–¢–≤–æ–π –¥–µ–Ω—å: –±–∞–ª–∞–Ω—Å –≤–æ–¥—ã, –∫–∞–ª–æ—Ä–∏–π –∏ –¥–≤–∏–∂–µ–Ω–∏–π</span>
        </div>
      </header>

      <main class="tabs">
        <!-- –ì–ª–∞–≤–Ω–∞—è -->
        <section class="tab active" id="tab-dashboard">
          <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–¢–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
                <div class="card-subtitle">–ü–æ–¥ –Ω–∏—Ö –ø–æ–¥—Å—Ç—Ä–æ–∏–º –≤–æ–¥—É –∏ –∫–∞–ª–æ—Ä–∏–∏</div>
              </div>
              <span class="inline-pill">
                <span style="width:8px;height:8px;border-radius:999px;background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,0.8);"></span>
                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å –∞–∫—Ç–∏–≤–µ–Ω</span>
              </span>
            </div>
            <div class="profile-grid">
              <div class="field">
                <label for="gender">–ü–æ–ª</label>
                <select id="gender">
                  <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                  <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                </select>
              </div>
              <div class="field">
                <label for="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
                <select id="activity">
                  <option value="1.2">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è</option>
                  <option value="1.375">–õ—ë–≥–∫–∞—è</option>
                  <option value="1.55">–°—Ä–µ–¥–Ω—è—è</option>
                  <option value="1.725">–í—ã—Å–æ–∫–∞—è</option>
                </select>
              </div>
              <div class="field">
                <label for="height">–†–æ—Å—Ç, —Å–º</label>
                <input id="height" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 165" />
              </div>
              <div class="field">
                <label for="weight">–í–µ—Å, –∫–≥</label>
                <input id="weight" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 68" />
              </div>
            </div>
            <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
              <span class="card-subtitle">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å</span>
              <span class="inline-pill">
                <span>‚âà</span>
                <strong id="calorieTargetText">‚Äî –∫–∫–∞–ª/–¥–µ–Ω—å</strong>
              </span>
            </div>
          </div>

          <!-- –ì—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞ -->
          <div class="card" style="margin-top:14px;">
            <div class="card-header">
              <div>
                <div class="card-title">–ì—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞</div>
                <div class="card-subtitle">–°–ª–µ–≤–∞ ‚Äî –∫—Ä–∏–≤–∞—è –ø–æ –¥–∞—Ç–∞–º, —Å–ø—Ä–∞–≤–∞ ‚Äî —Ü–∏—Ñ—Ä—ã –∏ –∏—Å—Ç–æ—Ä–∏—è</div>
              </div>
              <div style="display:flex;gap:6px;flex-wrap:wrap;">
                <button class="btn-ghost btn-sm" id="weightEditBtn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="btn-ghost btn-sm" id="weightClearBtn">–°—Ç–µ—Ä–µ—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
              </div>
            </div>
            <div class="weight-graph">
              <div class="weight-layout">
                <div class="weight-graph-panel">
                  <div class="weight-graph-header">
                    <div class="weight-graph-title">–¢–µ–∫—É—â–∏–π –≤–µ—Å</div>
                    <div class="weight-graph-value" id="currentWeightDisplay">
                      ‚Äî <span>–∫–≥</span>
                    </div>
                  </div>
                  <div class="weight-chart">
                    <div class="weight-y-axis" id="weightYAxis"></div>
                    <div class="weight-chart-main">
                      <div id="weightGraphCanvas" class="weight-graph-canvas">
                        <div class="weight-empty" id="weightEmptyText">
                          –î–æ–±–∞–≤—å –ø–µ—Ä–≤–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ, –∏ –ø–æ—è–≤–∏—Ç—Å—è –∫—Ä–∏–≤–∞—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Å–∞
                        </div>
                      </div>
                      <div class="weight-x-axis" id="weightXAxis"></div>
                    </div>
                  </div>
                </div>
                <div class="weight-data-panel">
                  <div class="weight-data-title">–î–∞–Ω–Ω—ã–µ</div>
                  <div class="weight-stats">
                    <div>
                      <div class="weight-stat-label">–°—Ç–∞—Ä—Ç–æ–≤—ã–π –≤–µ—Å</div>
                      <div class="weight-stat-value" id="weightStartValue">‚Äî –∫–≥</div>
                    </div>
                    <div>
                      <div class="weight-stat-label">–¢–µ–∫—É—â–∏–π –≤–µ—Å</div>
                      <div class="weight-stat-value" id="weightCurrentValue">‚Äî –∫–≥</div>
                    </div>
                    <div>
                      <div class="weight-stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
                      <div class="weight-stat-value" id="weightChangeValue">‚Äî –∫–≥</div>
                    </div>
                    <div>
                      <div class="weight-stat-label">–ò–∑–º–µ—Ä–µ–Ω–∏–π</div>
                      <div class="weight-stat-value" id="weightEntriesCount">0</div>
                    </div>
                  </div>
                  <div class="weight-history-title">–ò—Å—Ç–æ—Ä–∏—è</div>
                  <div class="weight-history-list" id="weightHistoryList">
                    <div class="weight-history-empty">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
                  </div>
                </div>
              </div>

              <div class="weight-actions">
                <div class="field">
                  <label for="weightEntry">–ù–æ–≤—ã–π –≤–µ—Å, –∫–≥</label>
                  <input id="weightEntry" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 67.4" />
                </div>
                <button class="btn btn-sm" id="addWeightEntryBtn">–í –≥—Ä–∞—Ñ–∏–∫</button>
              </div>
            </div>
          </div>

          <!-- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–º–µ—Ä—ã (–æ–±—Ö–≤–∞—Ç—ã) -->
          <div class="card" style="margin-top:14px;">
            <div class="card-header">
              <div>
                <div class="card-title">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–º–µ—Ä—ã (—Å–º)</div>
                <div class="card-subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π –æ–±—ä—ë–º—ã —Ç–µ–ª–∞ –≤–º–µ—Å—Ç–µ —Å –≤–µ—Å–æ–º</div>
              </div>
            </div>
            <div class="profile-grid">
              <div class="field">
                <label for="measureChest">–û–±—Ö–≤–∞—Ç –≥—Ä—É–¥–∏, —Å–º</label>
                <input id="measureChest" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 90" />
              </div>
              <div class="field">
                <label for="measureWaist">–û–±—Ö–≤–∞—Ç —Ç–∞–ª–∏–∏, —Å–º</label>
                <input id="measureWaist" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 70" />
              </div>
              <div class="field">
                <label for="measureHips">–û–±—Ö–≤–∞—Ç –±—ë–¥–µ—Ä, —Å–º</label>
                <input id="measureHips" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 98" />
              </div>
              <div class="field">
                <label for="measureThigh">–û–±—Ö–≤–∞—Ç –±–µ–¥—Ä–∞, —Å–º</label>
                <input id="measureThigh" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 55" />
              </div>
              <div class="field">
                <label for="measureCalf">–û–±—Ö–≤–∞—Ç –∏–∫—Ä—ã, —Å–º</label>
                <input id="measureCalf" type="number" inputmode="decimal" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 35" />
              </div>
            </div>
            <div class="measure-note">
              –ó–∞–º–µ—Ä –¥–ª—è –¥–∞—Ç—ã: <span id="measureDateLabel">‚Äî</span>. –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞ –¥–µ–Ω—å,
              –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è –æ–±–Ω–æ–≤—è—Ç—Å—è.
            </div>
            <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
              <button class="btn btn-sm" id="measureSaveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ä—ã</button>
              <button class="btn-ghost btn-sm" id="measureClearBtn">–°—Ç–µ—Ä–µ—Ç—å –∑–∞–º–µ—Ä—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è</button>
            </div>
            <div class="measure-history-list" id="measureHistoryList">
              <div class="weight-history-empty">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ä–æ–≤</div>
            </div>
          </div>

          <!-- –í–æ–¥–∞ + –∫–∞–ª–æ—Ä–∏–∏ -->
          <div class="card" style="margin-top:14px;">
            <div class="card-header">
              <div>
                <div class="card-title">–í–æ–¥–∞ –∏ –∫–∞–ª–æ—Ä–∏–∏</div>
                <div class="card-subtitle">–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ ‚Äî –±–æ–ª—å—à–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
              </div>
            </div>
            <div class="progress-row">
              <div>
                <div class="progress-label">–í–æ–¥–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="progress-value">
                  <span id="waterCurrent">0</span>/<span id="waterTarget">2000</span> –º–ª
                </div>
              </div>
              <div class="progress">
                <div id="waterProgress" class="progress-fill"></div>
              </div>
            </div>
            <div style="display:flex;gap:6px;margin-top:6px;">
              <button class="btn-ghost btn-sm" id="waterMinusBtn">‚Äì100 –º–ª</button>
              <button class="btn btn-sm" id="waterPlusBtn">+100 –º–ª</button>
            </div>

            <hr style="margin:10px 0;border:none;border-top:1px dashed rgba(129, 140, 248, 0.35);" />

            <div class="progress-row">
              <div>
                <div class="progress-label">–ö–∞–ª–æ—Ä–∏–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="progress-value">
                  <span id="caloriesCurrent">0</span>/<span id="caloriesTarget">‚Äî</span> –∫–∫–∞–ª
                </div>
              </div>
              <div class="progress">
                <div id="caloriesProgress" class="progress-fill"></div>
              </div>
            </div>
            <div style="display:flex;gap:6px;margin-top:6px;align-items:center;">
              <input id="caloriesInput" type="number" inputmode="decimal" placeholder="+ –∫–∫–∞–ª"
                     style="flex:1;background:rgba(20,12,46,0.95);border-radius:999px;border:1px solid rgba(148,131,244,0.7);padding:5px 10px;font-size:12px;color:var(--text-main);" />
              <button class="btn btn-sm" id="caloriesAddBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div style="margin-top:6px;display:flex;justify-content:flex-end;">
              <button class="btn-ghost btn-sm" id="caloriesResetBtn">–°–±—Ä–æ—Å</button>
            </div>
          </div>
        </section>

        <!-- –ü–∏—Ç–∞–Ω–∏–µ -->
        <section class="tab" id="tab-meals">
          <div class="card">
            <div class="recipes-header">
              <div>
                <div class="card-title">–ò–¥–µ–∏ –ü–ü‚Äë–ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏</div>
                <div class="recipes-note">–ù–∞–∂–º–∏ –Ω–∞ –±–ª—é–¥–æ ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ä–µ—Ü–µ–ø—Ç –∏ –≥—Ä–∞–º–º–æ–≤–∫–∏</div>
              </div>
              <button class="btn btn-sm" id="recipesRefreshBtn">–ï—â—ë –∏–¥–µ–∏</button>
            </div>
            <div id="recipesList" class="recipes-list"></div>
          </div>
        </section>

        <!-- –ú–∏–∫—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è -->
        <section class="tab" id="tab-micro">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–ú–∏–∫—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è</div>
                <div class="card-subtitle">–ù–µ–±–æ–ª—å—à–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</div>
              </div>
              <button class="btn-ghost btn-sm" id="microRefreshBtn">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="microList" class="microlist"></div>
          </div>
        </section>

        <!-- –î–Ω–µ–≤–Ω–∏–∫ -->
        <section class="tab" id="tab-diary">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">–î–Ω–µ–≤–Ω–∏–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</div>
                <div class="card-subtitle">–ó–∞–ø–∏—Å—ã–≤–∞–π, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è</div>
              </div>
            </div>
            <div class="diary-form">
              <input id="diaryTitleInput" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ú–æ–π –ª—É—á—à–∏–π –¥–µ–Ω—å¬ª" />
              <textarea id="diaryTextInput" rows="3" placeholder="–û–ø–∏—à–∏ —Å–≤–æ–∏ –ø–æ–±–µ–¥—ã: –≤–æ–¥–∞, —à–∞–≥–∏, –ø–∏—Ç–∞–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ..."></textarea>
              <button class="btn btn-block btn-sm" id="diarySaveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            </div>
            <div id="diaryList" class="diary-list"></div>
          </div>
        </section>
      </main>
    </div>

    <div class="bottom-nav-shell">
      <nav class="bottom-nav">
        <button class="tab-btn active" data-tab-target="tab-dashboard">
          <div class="tab-btn-icon">üè†</div>
          <div>–ì–ª–∞–≤–Ω–∞—è</div>
        </button>
        <button class="tab-btn" data-tab-target="tab-meals">
          <div class="tab-btn-icon">üçΩ</div>
          <div>–ü–∏—Ç–∞–Ω–∏–µ</div>
        </button>
        <button class="tab-btn" data-tab-target="tab-micro">
          <div class="tab-btn-icon">‚ö°</div>
          <div>–î–≤–∏–∂–µ–Ω–∏–µ</div>
        </button>
        <button class="tab-btn" data-tab-target="tab-diary">
          <div class="tab-btn-icon">üìì</div>
          <div>–î–Ω–µ–≤–Ω–∏–∫</div>
        </button>
      </nav>
    </div>

    <div class="modal" id="recipeModal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <div class="modal-title" id="modalRecipeTitle">–†–µ—Ü–µ–ø—Ç</div>
            <div style="font-size:11px;color:var(--text-muted);" id="modalRecipeTypeKcal"></div>
          </div>
          <button class="modal-close" id="modalCloseBtn">&times;</button>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;font-size:11px;color:var(--accent-soft);margin-bottom:4px;">
          <span id="modalRecipeMacros"></span>
        </div>

        <div class="modal-section-title">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</div>
        <ul class="ingredients-list" id="modalIngredientsList"></ul>

        <div class="modal-section-title">–ö–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å</div>
        <ol class="steps-list" id="modalStepsList"></ol>
      </div>
    </div>
  </div>

  <script>
    // ==== –•–†–ê–ù–ò–õ–ò–©–ï ====
    var STORAGE_KEYS = {
      PROFILE: "lavanda_profile",
      WEIGHTS: "lavanda_weights",
      WATER: "lavanda_water",
      CALORIES: "lavanda_calories",
      DIARY: "lavanda_diary",
      MEASURES: "lavanda_measures"
    };

    var storageAvailable = true;
    try {
      window.localStorage.setItem("__test", "1");
      window.localStorage.removeItem("__test");
    } catch (e) {
      storageAvailable = false;
    }

    function setStorage(key, value) {
      if (!storageAvailable) return;
      try { window.localStorage.setItem(key, value); } catch (e) {}
    }
    function getStorage(key) {
      if (!storageAvailable) return null;
      try { return window.localStorage.getItem(key); } catch (e) { return null; }
    }

    // ==== –î–ê–ù–ù–´–ï –†–ï–¶–ï–ü–¢–û–í ====
    var RECIPES = [
      {
        id: "oat_berries",
        title: "–û–≤—Å—è–Ω–∫–∞ —Å —è–≥–æ–¥–∞–º–∏ –∏ –æ—Ä–µ—Ö–∞–º–∏",
        type: "–ó–∞–≤—Ç—Ä–∞–∫",
        kcal: 350,
        protein: 15,
        carbs: 45,
        fat: 12,
        tag: "–ì–æ—Ç–æ–≤–æ –∑–∞ 5 –º–∏–Ω—É—Ç",
        ingredients: [
          { name: "–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è", amount: 50, unit: "–≥" },
          { name: "–ú–æ–ª–æ–∫–æ –∏–ª–∏ –≤–æ–¥–∞", amount: 150, unit: "–º–ª" },
          { name: "–ì—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç 2‚Äì5%", amount: 70, unit: "–≥" },
          { name: "–Ø–≥–æ–¥—ã (—Å–≤–µ–∂–∏–µ –∏–ª–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ)", amount: 70, unit: "–≥" },
          { name: "–û—Ä–µ—Ö–∏ (–≥—Ä–µ—Ü–∫–∏–µ/–º–∏–Ω–¥–∞–ª—å)", amount: 10, unit: "–≥" },
          { name: "–°–µ–º–µ–Ω–∞ —á–∏–∞ –∏–ª–∏ –ª—å–Ω–∞", amount: 5, unit: "–≥" }
        ],
        steps: [
          "–ó–∞–ª–µ–π —Ö–ª–æ–ø—å—è –≥–æ—Ä—è—á–µ–π –≤–æ–¥–æ–π –∏–ª–∏ –º–æ–ª–æ–∫–æ–º –∏ –¥–∞–π –ø–æ—Å—Ç–æ—è—Ç—å 5‚Äì7 –º–∏–Ω—É—Ç (–∏–ª–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤—å –Ω–∞ –ø–ª–∏—Ç–µ).",
          "–î–æ–±–∞–≤—å –π–æ–≥—É—Ä—Ç, —Ö–æ—Ä–æ—à–æ –ø–µ—Ä–µ–º–µ—à–∞–π.",
          "–°–≤–µ—Ä—Ö—É –≤—ã–ª–æ–∂–∏ —è–≥–æ–¥—ã, –ø–æ—Å—ã–ø—å –æ—Ä–µ—Ö–∞–º–∏ –∏ —Å–µ–º–µ–Ω–∞–º–∏.",
          "–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –¥–æ–±–∞–≤—å –Ω–µ–º–Ω–æ–≥–æ —Å—Ç–µ–≤–∏–∏ –∏–ª–∏ –º—ë–¥–∞ (–¥–æ 5 –≥)."
        ]
      },
      {
        id: "egg_toast",
        title: "–¢–æ—Å—Ç —Å —è–π—Ü–æ–º –∏ –∞–≤–æ–∫–∞–¥–æ",
        type: "–ó–∞–≤—Ç—Ä–∞–∫",
        kcal: 320,
        protein: 16,
        carbs: 26,
        fat: 16,
        tag: "–î–ª—è –∑–∞–Ω—è—Ç—ã—Ö —É—Ç—Ä–∞",
        ingredients: [
          { name: "–•–ª–µ–± —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π", amount: 40, unit: "–≥ (1 –ª–æ–º—Ç–∏–∫)" },
          { name: "–Ø–π—Ü–æ –∫—É—Ä–∏–Ω–æ–µ", amount: 1, unit: "—à—Ç" },
          { name: "–ê–≤–æ–∫–∞–¥–æ", amount: 40, unit: "–≥" },
          { name: "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫", amount: 5, unit: "–≥" },
          { name: "–°–æ–ª—å, –ø–µ—Ä–µ—Ü, –∑–µ–ª–µ–Ω—å", amount: 1, unit: "—â–µ–ø–æ—Ç–∫–∞ –ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–ü–æ–¥—Å—É—à–∏ –ª–æ–º—Ç–∏–∫ —Ö–ª–µ–±–∞ –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≤ —Ç–æ—Å—Ç–µ—Ä–µ.",
          "–°–≤–∞—Ä–∏ —è–π—Ü–æ (—Å–º—è—Ç–∫—É –∏–ª–∏ –≤–∫—Ä—É—Ç—É—é) –ª–∏–±–æ –ø—Ä–∏–≥–æ—Ç–æ–≤—å –≥–ª–∞–∑—É–Ω—å—é.",
          "–†–∞–∑–æ–º–Ω–∏ –∞–≤–æ–∫–∞–¥–æ –≤–∏–ª–∫–æ–π, –¥–æ–±–∞–≤—å –ª–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫, —Å–æ–ª—å –∏ –ø–µ—Ä–µ—Ü.",
          "–ù–∞–º–∞–∂—å –∞–≤–æ–∫–∞–¥–æ –Ω–∞ —Ç–æ—Å—Ç, —Å–≤–µ—Ä—Ö—É –≤—ã–ª–æ–∂–∏ —è–π—Ü–æ –∏ –ø–æ—Å—ã–ø—å –∑–µ–ª–µ–Ω—å—é."
        ]
      },
      {
        id: "chicken_bowl",
        title: "–ë–æ—É–ª —Å –∫—É—Ä–∏—Ü–µ–π –∏ –∫–∏–Ω–æ–∞",
        type: "–û–±–µ–¥",
        kcal: 450,
        protein: 35,
        carbs: 40,
        fat: 14,
        tag: "–°—ã—Ç–Ω—ã–π –∏ –ª—ë–≥–∫–∏–π",
        ingredients: [
          { name: "–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ", amount: 120, unit: "–≥" },
          { name: "–ö–∏–Ω–æ–∞ (—Å—ã—Ä–∞—è)", amount: 50, unit: "–≥" },
          { name: "–û–≥—É—Ä–µ—Ü", amount: 60, unit: "–≥" },
          { name: "–ü–æ–º–∏–¥–æ—Ä –∏–ª–∏ —á–µ—Ä—Ä–∏", amount: 60, unit: "–≥" },
          { name: "–õ–∏—Å—Ç–æ–≤–æ–π —Å–∞–ª–∞—Ç/—à–ø–∏–Ω–∞—Ç", amount: 40, unit: "–≥" },
          { name: "–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ", amount: 5, unit: "–≥" },
          { name: "–°–æ–ª—å, –ø–µ—Ä–µ—Ü, —Å–ø–µ—Ü–∏–∏", amount: 1, unit: "—â–µ–ø–æ—Ç–∫–∞ –ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–û—Ç–≤–∞—Ä–∏ –∫–∏–Ω–æ–∞ –≤ 2‚Äë—Ö —á–∞—Å—Ç—è—Ö –≤–æ–¥—ã –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ 15 –º–∏–Ω—É—Ç).",
          "–ö—É—Ä–∏–Ω–æ–µ —Ñ–∏–ª–µ –Ω–∞—Ä–µ–∂—å –∏ –æ–±–∂–∞—Ä—å –Ω–∞ —Å—É—Ö–æ–π —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≥—Ä–∏–ª–µ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏, –ø—Ä–∏–ø—Ä–∞–≤—å —Å–ø–µ—Ü–∏—è–º–∏.",
          "–û–≤–æ—â–∏ –Ω–∞—Ä–µ–∂—å –∫—É–±–∏–∫–∞–º–∏, –∑–µ–ª–µ–Ω—å –ø—Ä–æ–º–æ–π –∏ –æ–±—Å—É—à–∏.",
          "–°–æ–±–µ—Ä–∏ –±–æ—É–ª: –≤ –æ—Å–Ω–æ–≤—É –≤—ã–ª–æ–∂–∏ –∫–∏–Ω–æ–∞, —Å–≤–µ—Ä—Ö—É ‚Äî –∫—É—Ä–∏—Ü—É, –æ–≤–æ—â–∏ –∏ –∑–µ–ª–µ–Ω—å.",
          "–ü–æ–ª–µ–π –æ–ª–∏–≤–∫–æ–≤—ã–º –º–∞—Å–ª–æ–º, –ø–æ—Å–æ–ª–∏ –∏ –ø–æ–ø–µ—Ä—á–∏ –ø–æ –≤–∫—É—Å—É."
        ]
      },
      {
        id: "fish_veggies",
        title: "–ó–∞–ø–µ—á—ë–Ω–Ω–∞—è —Ä—ã–±–∞ —Å –æ–≤–æ—â–∞–º–∏",
        type: "–û–±–µ–¥",
        kcal: 420,
        protein: 32,
        carbs: 25,
        fat: 18,
        tag: "–î–ª—è –¥—É—Ö–æ–≤–∫–∏",
        ingredients: [
          { name: "–§–∏–ª–µ –±–µ–ª–æ–π —Ä—ã–±—ã (—Ç—Ä–µ—Å–∫–∞/—Ö–µ–∫/–º–∏–Ω—Ç–∞–π)", amount: 130, unit: "–≥" },
          { name: "–ë—Ä–æ–∫–∫–æ–ª–∏", amount: 80, unit: "–≥" },
          { name: "–¶–≤–µ—Ç–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞", amount: 80, unit: "–≥" },
          { name: "–ú–æ—Ä–∫–æ–≤—å", amount: 40, unit: "–≥" },
          { name: "–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ", amount: 5, unit: "–≥" },
          { name: "–õ–∏–º–æ–Ω, —Å–ø–µ—Ü–∏–∏, —Å–æ–ª—å", amount: 1, unit: "–ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–†–∞–∑–æ–≥—Ä–µ–π –¥—É—Ö–æ–≤–∫—É –¥–æ 180‚Äì190 ¬∞C.",
          "–†—ã–±—É –ø–æ—Å–æ–ª–∏, –ø–æ–ø–µ—Ä—á–∏, –¥–æ–±–∞–≤—å —Å–æ–∫ –ª–∏–º–æ–Ω–∞.",
          "–û–≤–æ—â–∏ –Ω–∞—Ä–µ–∂—å, —Å–±—Ä—ã–∑–Ω–∏ –æ–ª–∏–≤–∫–æ–≤—ã–º –º–∞—Å–ª–æ–º, –ø—Ä–∏–ø—Ä–∞–≤—å —Å–ø–µ—Ü–∏—è–º–∏.",
          "–í—ã–ª–æ–∂–∏ —Ä—ã–±—É –∏ –æ–≤–æ—â–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–µ–Ω—å, –∑–∞—Å—Ç–µ–ª–µ–Ω–Ω—ã–π –±—É–º–∞–≥–æ–π.",
          "–ó–∞–ø–µ–∫–∞–π 20‚Äì25 –º–∏–Ω—É—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä—ã–±—ã –∏ –º—è–≥–∫–æ—Å—Ç–∏ –æ–≤–æ—â–µ–π."
        ]
      },
      {
        id: "curd_dessert",
        title: "–¢–≤–æ—Ä–æ–∂–Ω–æ‚Äë—è–≥–æ–¥–Ω—ã–π –¥–µ—Å–µ—Ä—Ç",
        type: "–ü–µ—Ä–µ–∫—É—Å / –ü–æ–ª–¥–Ω–∏–∫",
        kcal: 200,
        protein: 18,
        carbs: 18,
        fat: 6,
        tag: "–ü–æ–ª–µ–∑–Ω—ã–π –¥–µ—Å–µ—Ä—Ç",
        ingredients: [
          { name: "–¢–≤–æ—Ä–æ–≥ 5%", amount: 100, unit: "–≥" },
          { name: "–ì—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç", amount: 40, unit: "–≥" },
          { name: "–Ø–≥–æ–¥—ã", amount: 50, unit: "–≥" },
          { name: "–û—Ä–µ—Ö–∏ –∏–∑–º–µ–ª—å—á—ë–Ω–Ω—ã–µ", amount: 5, unit: "–≥" },
          { name: "–ü–æ–¥—Å–ª–∞—Å—Ç–∏—Ç–µ–ª—å (–ø–æ –∂–µ–ª–∞–Ω–∏—é)", amount: 1, unit: "–ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–°–º–µ—à–∞–π —Ç–≤–æ—Ä–æ–≥ —Å –π–æ–≥—É—Ä—Ç–æ–º –¥–æ –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ–π –∫—Ä–µ–º–æ–≤–æ–π –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏–∏.",
          "–î–æ–±–∞–≤—å –ø–æ–¥—Å–ª–∞—Å—Ç–∏—Ç–µ–ª—å –ø–æ –≤–∫—É—Å—É –∏ –µ—â—ë —Ä–∞–∑ –ø–µ—Ä–µ–º–µ—à–∞–π.",
          "–°–≤–µ—Ä—Ö—É –≤—ã–ª–æ–∂–∏ —è–≥–æ–¥—ã –∏ –ø–æ—Å—ã–ø—å –æ—Ä–µ—Ö–∞–º–∏.",
          "–ú–æ–∂–Ω–æ –æ—Ö–ª–∞–¥–∏—Ç—å 10‚Äì15 –º–∏–Ω—É—Ç –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ."
        ]
      },
      {
        id: "greek_salad",
        title: "–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–π —Å–∞–ª–∞—Ç",
        type: "–£–∂–∏–Ω",
        kcal: 320,
        protein: 14,
        carbs: 18,
        fat: 20,
        tag: "–õ—ë–≥–∫–∏–π –≤–µ—á–µ—Ä",
        ingredients: [
          { name: "–û–≥—É—Ä–µ—Ü", amount: 80, unit: "–≥" },
          { name: "–ü–æ–º–∏–¥–æ—Ä—ã –∏–ª–∏ —á–µ—Ä—Ä–∏", amount: 80, unit: "–≥" },
          { name: "–ü–µ—Ä–µ—Ü —Å–ª–∞–¥–∫–∏–π", amount: 50, unit: "–≥" },
          { name: "–°—ã—Ä —Ñ–µ—Ç–∞ –∏–ª–∏ –±—Ä—ã–Ω–∑–∞ 20‚Äì30%", amount: 40, unit: "–≥" },
          { name: "–û–ª–∏–≤–∫–∏/–º–∞—Å–ª–∏–Ω—ã", amount: 20, unit: "–≥" },
          { name: "–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ", amount: 7, unit: "–≥" },
          { name: "–õ–∏–º–æ–Ω–Ω—ã–π —Å–æ–∫, –æ—Ä–µ–≥–∞–Ω–æ", amount: 1, unit: "–ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–ù–∞—Ä–µ–∂—å –æ–≤–æ—â–∏ –∫—Ä—É–ø–Ω—ã–º–∏ –∫—É–±–∏–∫–∞–º–∏, –≤—ã–ª–æ–∂–∏ –≤ —Å–∞–ª–∞—Ç–Ω–∏–∫.",
          "–°—ã—Ä –Ω–∞—Ä–µ–∂—å –∫—É–±–∏–∫–∞–º–∏ –∏ –¥–æ–±–∞–≤—å –∫ –æ–≤–æ—â–∞–º.",
          "–î–æ–±–∞–≤—å –æ–ª–∏–≤–∫–∏ –∏–ª–∏ –º–∞—Å–ª–∏–Ω—ã.",
          "–°–º–µ—à–∞–π –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ —Å –ª–∏–º–æ–Ω–Ω—ã–º —Å–æ–∫–æ–º –∏ –æ—Ä–µ–≥–∞–Ω–æ.",
          "–ü–æ–ª–µ–π —Å–∞–ª–∞—Ç –∑–∞–ø—Ä–∞–≤–∫–æ–π –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–º–µ—à–∞–π."
        ]
      },
      {
        id: "buckwheat_meatballs",
        title: "–¢–µ—Ñ—Ç–µ–ª–∏ –∏–∑ –∏–Ω–¥–µ–π–∫–∏ —Å –≥—Ä–µ—á–∫–æ–π",
        type: "–û–±–µ–¥ / –£–∂–∏–Ω",
        kcal: 430,
        protein: 32,
        carbs: 42,
        fat: 14,
        tag: "–î–æ–º–∞—à–Ω–µ–µ –∏ —Å—ã—Ç–Ω–æ",
        ingredients: [
          { name: "–§–∞—Ä—à –∏–∑ –∏–Ω–¥–µ–π–∫–∏", amount: 130, unit: "–≥" },
          { name: "–ì—Ä–µ—á–∫–∞ (—Å—ã—Ä–∞—è)", amount: 50, unit: "–≥" },
          { name: "–õ—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", amount: 20, unit: "–≥" },
          { name: "–Ø–∏—á–Ω—ã–π –±–µ–ª–æ–∫", amount: 1, unit: "—à—Ç" },
          { name: "–¢–æ–º–∞—Ç–Ω–æ–µ –ø—é—Ä–µ –±–µ–∑ —Å–∞—Ö–∞—Ä–∞", amount: 40, unit: "–≥" },
          { name: "–°–æ–ª—å, –ø–µ—Ä–µ—Ü, —Å–ø–µ—Ü–∏–∏", amount: 1, unit: "–ø–æ –≤–∫—É—Å—É" }
        ],
        steps: [
          "–û—Ç–≤–∞—Ä–∏ –≥—Ä–µ—á–∫—É –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.",
          "–°–º–µ—à–∞–π —Ñ–∞—Ä—à, –æ—Å—Ç—ã–≤—à—É—é –≥—Ä–µ—á–∫—É, –º–µ–ª–∫–æ –Ω–∞—Ä–µ–∑–∞–Ω–Ω—ã–π –ª—É–∫ –∏ –±–µ–ª–æ–∫.",
          "–°—Ñ–æ—Ä–º–∏—Ä—É–π –Ω–µ–±–æ–ª—å—à–∏–µ —Ç–µ—Ñ—Ç–µ–ª–∏.",
          "–í—ã–ª–æ–∂–∏ –≤ —Ñ–æ—Ä–º—É, –∑–∞–ª–µ–π —Ç–æ–º–∞—Ç–Ω—ã–º –ø—é—Ä–µ —Å –≤–æ–¥–æ–π –∏ —Å–ø–µ—Ü–∏—è–º–∏.",
          "–ó–∞–ø–µ–∫–∞–π –ø—Ä–∏ 180 ¬∞C 25‚Äì30 –º–∏–Ω—É—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏."
        ]
      },
      {
        id: "salmon_sandwich",
        title: "–§–∏—Ç–Ω–µ—Å‚Äë—Å—ç–Ω–¥–≤–∏—á —Å –ª–æ—Å–æ—Å–µ–º",
        type: "–ü–µ—Ä–µ–∫—É—Å / –õ—ë–≥–∫–∏–π —É–∂–∏–Ω",
        kcal: 310,
        protein: 19,
        carbs: 28,
        fat: 14,
        tag: "–ë—ã—Å—Ç—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç",
        ingredients: [
          { name: "–•–ª–µ–± —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π", amount: 60, unit: "–≥ (2 –ª–æ–º—Ç–∏–∫–∞)" },
          { name: "–õ–æ—Å–æ—Å—å —Å–ª–∞–±–æ—Å–æ–ª—ë–Ω—ã–π", amount: 40, unit: "–≥" },
          { name: "–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä light", amount: 20, unit: "–≥" },
          { name: "–û–≥—É—Ä–µ—Ü", amount: 40, unit: "–≥" },
          { name: "–õ–∏—Å—Ç —Å–∞–ª–∞—Ç–∞", amount: 10, unit: "–≥" }
        ],
        steps: [
          "–ü–æ–¥—Å—É—à–∏ —Ö–ª–µ–± –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≤ —Ç–æ—Å—Ç–µ—Ä–µ.",
          "–ù–∞–º–∞–∂—å —Ç–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä –Ω–∞ –æ–±–∞ –ª–æ–º—Ç–∏–∫–∞.",
          "–î–æ–±–∞–≤—å –ª–æ–º—Ç–∏–∫–∏ –æ–≥—É—Ä—Ü–∞, –ª–æ—Å–æ—Å—è –∏ –ª–∏—Å—Ç —Å–∞–ª–∞—Ç–∞.",
          "–°–æ–µ–¥–∏–Ω–∏ –ª–æ–º—Ç–∏–∫–∏ –≤ —Å—ç–Ω–¥–≤–∏—á –∏ —Ä–∞–∑—Ä–µ–∂—å –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏."
        ]
      },
      {
        id: "veggie_omelette",
        title: "–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏",
        type: "–ó–∞–≤—Ç—Ä–∞–∫ / –£–∂–∏–Ω",
        kcal: 280,
        protein: 20,
        carbs: 10,
        fat: 16,
        tag: "–ú–∞–ª–æ —É–≥–ª–µ–≤–æ–¥–æ–≤",
        ingredients: [
          { name: "–Ø–π—Ü–∞", amount: 2, unit: "—à—Ç" },
          { name: "–ë–µ–ª–æ–∫ —è–∏—á–Ω—ã–π", amount: 1, unit: "—à—Ç" },
          { name: "–ü–æ–º–∏–¥–æ—Ä", amount: 50, unit: "–≥" },
          { name: "–ü–µ—Ä–µ—Ü —Å–ª–∞–¥–∫–∏–π", amount: 40, unit: "–≥" },
          { name: "–®–ø–∏–Ω–∞—Ç –∏–ª–∏ –∑–µ–ª–µ–Ω—å", amount: 20, unit: "–≥" },
          { name: "–ú–∞—Å–ª–æ (–¥–ª—è —Å–º–∞–∑–∫–∏)", amount: 3, unit: "–≥" }
        ],
        steps: [
          "–°–ª–µ–≥–∫–∞ —Å–º–∞–∂—å —Å–∫–æ–≤–æ—Ä–æ–¥—É –º–∞—Å–ª–æ–º –∏ —Ä–∞–∑–æ–≥—Ä–µ–π.",
          "–û–≤–æ—â–∏ –Ω–∞—Ä–µ–∂—å –º–µ–ª–∫–∏–º–∏ –∫—É—Å–æ—á–∫–∞–º–∏.",
          "–í–∑–±–µ–π —è–π—Ü–∞ —Å –±–µ–ª–∫–æ–º, –ø–æ—Å–æ–ª–∏ –∏ –ø–æ–ø–µ—Ä—á–∏.",
          "–û–±–∂–∞—Ä—å –æ–≤–æ—â–∏ 1‚Äì2 –º–∏–Ω—É—Ç—ã, –∑–∞—Ç–µ–º –∑–∞–ª–µ–π —è–π—Ü–∞–º–∏.",
          "–ì–æ—Ç–æ–≤—å –ø–æ–¥ –∫—Ä—ã—à–∫–æ–π –Ω–∞ —Å–ª–∞–±–æ–º –æ–≥–Ω–µ –¥–æ —Å—Ö–≤–∞—Ç—ã–≤–∞–Ω–∏—è –æ–º–ª–µ—Ç–∞."
        ]
      }
    ];

    var MICRO_MOVES = [
      { title: "10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π —É—Ç—Ä–æ–º", meta: "1 –º–∏–Ω—É—Ç–∞, –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–∑–≥–æ–Ω—è–µ—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ." },
      { title: "–ü—Ä–æ–π—Ç–∏—Å—å –ø–æ –∫–æ–º–Ω–∞—Ç–µ –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞", meta: "5‚Äì10 –º–∏–Ω—É—Ç –ª—ë–≥–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏." },
      { title: "–°—Ç—Ä–µ—Ç—á–∏–Ω–≥ —à–µ–∏ –∏ –ø–ª–µ—á", meta: "2 –º–∏–Ω—É—Ç—ã, —Å–Ω–∏–º–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ." },
      { title: "–ü–æ–¥–Ω—è—Ç—å—Å—è –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ –ø–µ—à–∫–æ–º", meta: "–í—ã–±–µ—Ä–∏ 3‚Äì5 —ç—Ç–∞–∂–µ–π –≤–º–µ—Å—Ç–æ –ª–∏—Ñ—Ç–∞." },
      { title: "20 –º–∞—Ö–æ–≤ —Ä—É–∫–∞–º–∏ –∏ —à–∞–≥–∏ –Ω–∞ –º–µ—Å—Ç–µ", meta: "1‚Äì2 –º–∏–Ω—É—Ç—ã, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–ª–∞ —Å–∏–¥–µ—Ç—å." },
      { title: "–õ—ë–≥–∫–∞—è –∑–∞—Ä—è–¥–∫–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º", meta: "3 –º–∏–Ω—É—Ç—ã –º—è–≥–∫–∏—Ö –Ω–∞–∫–ª–æ–Ω–æ–≤ –∏ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ –∫–æ—Ä–ø—É—Å–∞." },
      { title: "–°—Ç–æ—è—Ç—å –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏", meta: "5 –º–∏–Ω—É—Ç —Å—Ç–æ—è –≤–º–µ—Å—Ç–æ —Å–∏–¥–µ–Ω–∏—è." },
      { title: "–ö–∞–∂–¥—ã–π —á–∞—Å ‚Äî 20‚Äì30 —à–∞–≥–æ–≤", meta: "–í—Å—Ç–∞–Ω—å –æ—Ç —Å—Ç–æ–ª–∞ –∏ –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–π–¥–∏—Å—å." }
    ];

    function todayKey() {
      return new Date().toISOString().slice(0, 10);
    }

    function clamp(num, min, max) {
      return Math.min(Math.max(num, min), max);
    }

    function formatDateTime(dt) {
      var d = new Date(dt);
      var date = d.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });
      var time = d.toLocaleTimeString("ru-RU", { hour: "2-digit", minute: "2-digit" });
      return date + " ‚Ä¢ " + time;
    }

    // ==== DOM ====
    var tabButtons = document.querySelectorAll(".tab-btn");
    var tabs = document.querySelectorAll(".tab");

    var genderEl = document.getElementById("gender");
    var activityEl = document.getElementById("activity");
    var heightEl = document.getElementById("height");
    var weightEl = document.getElementById("weight");
    var calorieTargetTextEl = document.getElementById("calorieTargetText");
    var caloriesTargetEl = document.getElementById("caloriesTarget");
    var waterTargetEl = document.getElementById("waterTarget");

    var weightGraphCanvasEl = document.getElementById("weightGraphCanvas");
    var weightEmptyEl = document.getElementById("weightEmptyText");
    var weightYAxisEl = document.getElementById("weightYAxis");
    var weightXAxisEl = document.getElementById("weightXAxis");
    var weightEntryEl = document.getElementById("weightEntry");
    var addWeightEntryBtn = document.getElementById("addWeightEntryBtn");
    var currentWeightDisplayEl = document.getElementById("currentWeightDisplay");
    var weightStartValueEl = document.getElementById("weightStartValue");
    var weightCurrentValueEl = document.getElementById("weightCurrentValue");
    var weightChangeValueEl = document.getElementById("weightChangeValue");
    var weightEntriesCountEl = document.getElementById("weightEntriesCount");
    var weightHistoryListEl = document.getElementById("weightHistoryList");
    var weightEditBtn = document.getElementById("weightEditBtn");
    var weightClearBtn = document.getElementById("weightClearBtn");

    var measureChestEl = document.getElementById("measureChest");
    var measureWaistEl = document.getElementById("measureWaist");
    var measureHipsEl = document.getElementById("measureHips");
    var measureThighEl = document.getElementById("measureThigh");
    var measureCalfEl = document.getElementById("measureCalf");
    var measureDateLabelEl = document.getElementById("measureDateLabel");
    var measureSaveBtn = document.getElementById("measureSaveBtn");
    var measureClearBtn = document.getElementById("measureClearBtn");
    var measureHistoryListEl = document.getElementById("measureHistoryList");

    var waterCurrentEl = document.getElementById("waterCurrent");
    var waterProgressEl = document.getElementById("waterProgress");
    var waterPlusBtn = document.getElementById("waterPlusBtn");
    var waterMinusBtn = document.getElementById("waterMinusBtn");

    var caloriesCurrentEl = document.getElementById("caloriesCurrent");
    var caloriesProgressEl = document.getElementById("caloriesProgress");
    var caloriesInputEl = document.getElementById("caloriesInput");
    var caloriesAddBtn = document.getElementById("caloriesAddBtn");
    var caloriesResetBtn = document.getElementById("caloriesResetBtn");

    var recipesListEl = document.getElementById("recipesList");
    var recipesRefreshBtn = document.getElementById("recipesRefreshBtn");

    var recipeModalEl = document.getElementById("recipeModal");
    var modalRecipeTitleEl = document.getElementById("modalRecipeTitle");
    var modalRecipeTypeKcalEl = document.getElementById("modalRecipeTypeKcal");
    var modalRecipeMacrosEl = document.getElementById("modalRecipeMacros");
    var modalIngredientsListEl = document.getElementById("modalIngredientsList");
    var modalStepsListEl = document.getElementById("modalStepsList");
    var modalCloseBtn = document.getElementById("modalCloseBtn");

    var microListEl = document.getElementById("microList");
    var microRefreshBtn = document.getElementById("microRefreshBtn");

    var diaryTitleInputEl = document.getElementById("diaryTitleInput");
    var diaryTextInputEl = document.getElementById("diaryTextInput");
    var diarySaveBtn = document.getElementById("diarySaveBtn");
    var diaryListEl = document.getElementById("diaryList");

    // ==== –¢–ê–ë–´ ====
    for (var i = 0; i < tabButtons.length; i++) {
      tabButtons[i].onclick = function () {
        var targetId = this.getAttribute("data-tab-target");
        for (var j = 0; j < tabButtons.length; j++) {
          if (tabButtons[j] === this) tabButtons[j].classList.add("active");
          else tabButtons[j].classList.remove("active");
        }
        for (var k = 0; k < tabs.length; k++) {
          if (tabs[k].id === targetId) tabs[k].classList.add("active");
          else tabs[k].classList.remove("active");
        }
      };
    }

    // ==== –ü–†–û–§–ò–õ–¨ ====
    function loadProfile() {
      var raw = getStorage(STORAGE_KEYS.PROFILE);
      if (!raw) return null;
      try { return JSON.parse(raw); } catch (e) { return null; }
    }

    function saveProfile(profile) {
      setStorage(STORAGE_KEYS.PROFILE, JSON.stringify(profile));
    }

    function estimateCalorieTarget(profile) {
      if (!profile || !profile.weight) return null;
      var weight = Number(profile.weight);
      var genderFactor = profile.gender === "male" ? 24 : 22;
      var base = weight * genderFactor;
      var activity = Number(profile.activity || 1.2);
      return Math.round(base * activity * 0.85);
    }

    function updateProfileFromUI(save) {
      if (save === undefined) save = true;
      var profile = {
        gender: genderEl.value,
        activity: activityEl.value,
        height: heightEl.value ? Number(heightEl.value) : null,
        weight: weightEl.value ? Number(weightEl.value) : null
      };
      if (save) saveProfile(profile);

      var calTarget = estimateCalorieTarget(profile);
      if (calTarget) {
        calorieTargetTextEl.innerHTML = calTarget + " –∫–∫–∞–ª/–¥–µ–Ω—å";
        caloriesTargetEl.innerHTML = calTarget;
      } else {
        calorieTargetTextEl.innerHTML = "‚Äî –∫–∫–∞–ª/–¥–µ–Ω—å";
        caloriesTargetEl.innerHTML = "‚Äî";
      }

      if (profile.weight) {
        var waterTarget = Math.round(profile.weight * 30);
        waterTargetEl.innerHTML = waterTarget;
      }

      syncCaloriesProgress();
      syncWaterProgress();
    }

    var storedProfile = loadProfile();
    if (storedProfile) {
      if (storedProfile.gender) genderEl.value = storedProfile.gender;
      if (storedProfile.activity) activityEl.value = storedProfile.activity;
      if (storedProfile.height != null) heightEl.value = storedProfile.height;
      if (storedProfile.weight != null) weightEl.value = storedProfile.weight;
    }

    genderEl.onchange = activityEl.onchange = heightEl.onchange = weightEl.onchange = function () {
      updateProfileFromUI(true);
    };

    // ==== –í–ï–° ====
    function loadWeights() {
      var raw = getStorage(STORAGE_KEYS.WEIGHTS);
      if (!raw) return [];
      try {
        var arr = JSON.parse(raw);
        if (Object.prototype.toString.call(arr) === "[object Array]") return arr;
        return [];
      } catch (e) { return []; }
    }
    function saveWeights(list) {
      setStorage(STORAGE_KEYS.WEIGHTS, JSON.stringify(list));
    }

    var weightHistory = loadWeights();

    function renderWeightGraph() {
      weightGraphCanvasEl.innerHTML = "";
      weightXAxisEl.innerHTML = "";
      weightYAxisEl.innerHTML = "";

      if (!weightHistory || weightHistory.length === 0) {
        weightGraphCanvasEl.appendChild(weightEmptyEl);
        weightEmptyEl.style.display = "block";
        currentWeightDisplayEl.innerHTML = "‚Äî <span>–∫–≥</span>";
        weightStartValueEl.innerHTML = "‚Äî –∫–≥";
        weightCurrentValueEl.innerHTML = "‚Äî –∫–≥";
        weightChangeValueEl.innerHTML = "‚Äî –∫–≥";
        weightEntriesCountEl.innerHTML = "0";
        weightHistoryListEl.innerHTML = '<div class="weight-history-empty">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
        return;
      }

      weightEmptyEl.style.display = "none";

      var maxWeight = weightHistory[0].value;
      var minWeight = weightHistory[0].value;
      for (var i = 1; i < weightHistory.length; i++) {
        var v = weightHistory[i].value;
        if (v > maxWeight) maxWeight = v;
        if (v < minWeight) minWeight = v;
      }

      var first = weightHistory[0];
      var latest = weightHistory[weightHistory.length - 1];

      currentWeightDisplayEl.innerHTML = latest.value.toFixed(1) + " <span>–∫–≥</span>";
      weightStartValueEl.innerHTML = first.value.toFixed(1) + " –∫–≥";
      weightCurrentValueEl.innerHTML = latest.value.toFixed(1) + " –∫–≥";
      var diff = latest.value - first.value;
      var sign = diff > 0 ? "+" : "";
      weightChangeValueEl.innerHTML = sign + diff.toFixed(1) + " –∫–≥";
      weightEntriesCountEl.innerHTML = String(weightHistory.length);

      weightHistoryListEl.innerHTML = "";
      for (var j = weightHistory.length - 1; j >= 0; j--) {
        var entry = weightHistory[j];
        var d = new Date(entry.date);
        var day = ("" + d.getDate()).replace(/^(\d)$/, "0$1") + "." + ("" + (d.getMonth() + 1)).replace(/^(\d)$/, "0$1");
        var item = document.createElement("div");
        item.className = "weight-history-item";
        item.innerHTML = "<span>" + day + "</span><span>" + entry.value.toFixed(1) + " –∫–≥</span>";
        weightHistoryListEl.appendChild(item);
      }

      var top = Math.ceil(maxWeight * 10) / 10;
      var bottom = Math.floor(minWeight * 10) / 10;
      var mid = ((top + bottom) / 2).toFixed(1);
      var yVals = [top, mid, bottom];
      for (var yi = 0; yi < yVals.length; yi++) {
        var span = document.createElement("span");
        span.innerHTML = yVals[yi] + " –∫–≥";
        weightYAxisEl.appendChild(span);
      }

      var svgNS = "http://www.w3.org/2000/svg";
      var svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("class", "weight-line-svg");
      svg.setAttribute("viewBox", "0 0 100 100");
      svg.setAttribute("preserveAspectRatio", "none");

      var range = maxWeight - minWeight;
      if (range === 0) range = 1;
      var n = weightHistory.length;
      var pointsStr = "";
      for (var idx = 0; idx < weightHistory.length; idx++) {
        var e = weightHistory[idx];
        var x = n === 1 ? 50 : (idx / (n - 1)) * 100;
        var relative = (e.value - minWeight) / range;
        var y = 90 - relative * 80;
        pointsStr += x + "," + y + " ";

        var circle = document.createElementNS(svgNS, "circle");
        circle.setAttribute("cx", x);
        circle.setAttribute("cy", y);
        circle.setAttribute("r", 1.8);
        circle.setAttribute("fill", "#f9a8ff");
        circle.setAttribute("stroke", "#a855f7");
        circle.setAttribute("stroke-width", "0.4");
        svg.appendChild(circle);
      }

      var polyline = document.createElementNS(svgNS, "polyline");
      polyline.setAttribute("fill", "none");
      polyline.setAttribute("stroke", "#c4b5fd");
      polyline.setAttribute("stroke-width", "0.8");
      polyline.setAttribute("stroke-linejoin", "round");
      polyline.setAttribute("stroke-linecap", "round");
      polyline.setAttribute("points", pointsStr.replace(/\s+$/, ""));
      svg.insertBefore(polyline, svg.firstChild);

      weightGraphCanvasEl.appendChild(svg);

      for (var xi = 0; xi < weightHistory.length; xi++) {
        var ed = weightHistory[xi];
        var dd = new Date(ed.date);
        var dday = ("" + dd.getDate()).replace(/^(\d)$/, "0$1") + "." + ("" + (dd.getMonth() + 1)).replace(/^(\d)$/, "0$1");
        var xLabel = document.createElement("div");
        xLabel.className = "weight-x-label";
        xLabel.innerHTML = dday;
        weightXAxisEl.appendChild(xLabel);
      }
    }

    addWeightEntryBtn.onclick = function () {
      var valStr = weightEntryEl.value.trim();
      if (!valStr) return;
      var value = Number(valStr.replace(",", "."));
      if (!value || value <= 0) return;

      var entry = { value: value, date: new Date().toISOString() };
      weightHistory.push(entry);
      if (weightHistory.length > 60) {
        weightHistory = weightHistory.slice(weightHistory.length - 60);
      }
      saveWeights(weightHistory);

      weightEl.value = String(value);
      updateProfileFromUI(true);

      weightEntryEl.value = "";
      renderWeightGraph();
    };

    if (weightEditBtn) {
      weightEditBtn.onclick = function () {
        if (weightHistory && weightHistory.length) {
          var last = weightHistory[weightHistory.length - 1];
          weightEntryEl.value = String(last.value).replace(".", ",");
        }
        weightEntryEl.focus();
        window.scrollTo(0, weightGraphCanvasEl.getBoundingClientRect().top + window.pageYOffset - 60);
      };
    }

    if (weightClearBtn) {
      weightClearBtn.onclick = function () {
        if (!confirm("–°—Ç–µ—Ä–µ—Ç—å –≤—Å–µ —Ç–æ—á–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –≤–µ—Å–∞?")) return;
        weightHistory = [];
        saveWeights(weightHistory);
        renderWeightGraph();
      };
    }

    // ==== –ó–ê–ú–ï–†–´ ====
    function loadMeasures() {
      var raw = getStorage(STORAGE_KEYS.MEASURES);
      if (!raw) return [];
      try {
        var arr = JSON.parse(raw);
        if (Object.prototype.toString.call(arr) === "[object Array]") return arr;
        return [];
      } catch (e) { return []; }
    }
    function saveMeasures(list) {
      setStorage(STORAGE_KEYS.MEASURES, JSON.stringify(list));
    }

    var measuresHistory = loadMeasures();

    function renderMeasures() {
      var d = new Date();
      var dateStr = d.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });
      measureDateLabelEl.innerHTML = dateStr;

      measureHistoryListEl.innerHTML = "";
      if (!measuresHistory.length) {
        measureHistoryListEl.innerHTML = '<div class="weight-history-empty">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ä–æ–≤</div>';
      } else {
        var sorted = measuresHistory.slice().sort(function (a, b) {
          return new Date(b.date) - new Date(a.date);
        });
        for (var i = 0; i < sorted.length; i++) {
          var e = sorted[i];
          var dd = new Date(e.date);
          var dstr = dd.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });
          var item = document.createElement("div");
          item.className = "measure-history-item";
          item.innerHTML =
            '<div class="measure-date">' + dstr + '</div>' +
            '<div class="measure-values">' +
            '–ì: ' + (e.chest || "‚Äî") +
            ' ‚Ä¢ –¢: ' + (e.waist || "‚Äî") +
            ' ‚Ä¢ –ë: ' + (e.hips || "‚Äî") +
            ' ‚Ä¢ –ë–µ–¥—Ä–æ: ' + (e.thigh || "‚Äî") +
            ' ‚Ä¢ –ò–∫—Ä–∞: ' + (e.calf || "‚Äî") +
            '</div>';
          measureHistoryListEl.appendChild(item);
        }

        var last = sorted[0];
        measureChestEl.value = last.chest || "";
        measureWaistEl.value = last.waist || "";
        measureHipsEl.value = last.hips || "";
        measureThighEl.value = last.thigh || "";
        measureCalfEl.value = last.calf || "";
      }
    }

    measureSaveBtn.onclick = function () {
      var chest = measureChestEl.value.trim();
      var waist = measureWaistEl.value.trim();
      var hips  = measureHipsEl.value.trim();
      var thigh = measureThighEl.value.trim();
      var calf  = measureCalfEl.value.trim();

      if (!chest && !waist && !hips && !thigh && !calf) return;

      var today = todayKey();
      var found = -1;
      for (var i = 0; i < measuresHistory.length; i++) {
        if (measuresHistory[i].dateKey === today) {
          found = i; break;
        }
      }

      var entry = {
        date: new Date().toISOString(),
        dateKey: today,
        chest: chest ? Number(chest.replace(",", ".")) : null,
        waist: waist ? Number(waist.replace(",", ".")) : null,
        hips:  hips  ? Number(hips.replace(",", "."))  : null,
        thigh: thigh ? Number(thigh.replace(",", ".")) : null,
        calf:  calf  ? Number(calf.replace(",", "."))  : null
      };

      if (found >= 0) measuresHistory[found] = entry;
      else measuresHistory.push(entry);

      saveMeasures(measuresHistory);
      renderMeasures();
    };

    measureClearBtn.onclick = function () {
      var today = todayKey();
      var newList = [];
      var hasToday = false;

      for (var i = 0; i < measuresHistory.length; i++) {
        if (measuresHistory[i].dateKey === today) {
          hasToday = true;
        } else {
          newList.push(measuresHistory[i]);
        }
      }

      if (!hasToday) {
        alert("–ó–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–º–µ—Ä–æ–≤ –µ—â—ë –Ω–µ—Ç.");
        return;
      }

      if (!confirm("–°—Ç–µ—Ä–µ—Ç—å –∑–∞–º–µ—Ä—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è?")) return;

      measuresHistory = newList;
      saveMeasures(measuresHistory);

      measureChestEl.value = "";
      measureWaistEl.value = "";
      measureHipsEl.value = "";
      measureThighEl.value = "";
      measureCalfEl.value = "";

      renderMeasures();
    };

    // ==== –í–û–î–ê ====
    function loadWater() {
      var raw = getStorage(STORAGE_KEYS.WATER);
      if (!raw) return { date: todayKey(), value: 0 };
      try {
        var obj = JSON.parse(raw);
        if (!obj.date || obj.date !== todayKey()) return { date: todayKey(), value: 0 };
        return obj;
      } catch (e) { return { date: todayKey(), value: 0 }; }
    }
    function saveWater(state) {
      setStorage(STORAGE_KEYS.WATER, JSON.stringify(state));
    }

    var waterState = loadWater();

    function syncWaterProgress() {
      var target = Number(waterTargetEl.innerHTML);
      if (!target || isNaN(target)) target = 2000;
      var current = clamp(waterState.value || 0, 0, 6000);
      waterCurrentEl.innerHTML = current;
      var percent = clamp((current / target) * 100, 0, 100);
      waterProgressEl.style.width = percent + "%";
    }

    waterPlusBtn.onclick = function () {
      waterState.value = (waterState.value || 0) + 100;
      waterState.date = todayKey();
      saveWater(waterState);
      syncWaterProgress();
    };
    waterMinusBtn.onclick = function () {
      waterState.value = Math.max(0, (waterState.value || 0) - 100);
      waterState.date = todayKey();
      saveWater(waterState);
      syncWaterProgress();
    };

    // ==== –ö–ê–õ–û–†–ò–ò ====
    function loadCalories() {
      var raw = getStorage(STORAGE_KEYS.CALORIES);
      if (!raw) return { date: todayKey(), value: 0 };
      try {
        var obj = JSON.parse(raw);
        if (!obj.date || obj.date !== todayKey()) return { date: todayKey(), value: 0 };
        return obj;
      } catch (e) { return { date: todayKey(), value: 0 }; }
    }
    function saveCalories(state) {
      setStorage(STORAGE_KEYS.CALORIES, JSON.stringify(state));
    }

    var caloriesState = loadCalories();

    function syncCaloriesProgress() {
      var target = Number(caloriesTargetEl.innerHTML);
      if (!target || isNaN(target)) target = 1600;
      var current = clamp(caloriesState.value || 0, 0, 8000);
      caloriesCurrentEl.innerHTML = current;
      caloriesTargetEl.innerHTML = target;
      var percent = clamp((current / target) * 100, 0, 130);
      caloriesProgressEl.style.width = percent + "%";
    }

    caloriesAddBtn.onclick = function () {
      var valStr = caloriesInputEl.value.trim();
      if (!valStr) return;
      var value = Number(valStr.replace(",", "."));
      if (!value || value <= 0) return;
      caloriesState.value = (caloriesState.value || 0) + value;
      caloriesState.date = todayKey();
      saveCalories(caloriesState);
      caloriesInputEl.value = "";
      syncCaloriesProgress();
    };

    caloriesResetBtn.onclick = function () {
      caloriesState = { date: todayKey(), value: 0 };
      saveCalories(caloriesState);
      syncCaloriesProgress();
    };

    // ==== –†–ï–¶–ï–ü–¢–´ ====
    function openRecipeModal(recipe) {
      modalRecipeTitleEl.innerHTML = recipe.title;
      modalRecipeTypeKcalEl.innerHTML = recipe.type + " ‚Ä¢ " + recipe.kcal + " –∫–∫–∞–ª";
      modalRecipeMacrosEl.innerHTML =
        "–ë: " + recipe.protein + " –≥ ‚Ä¢ –ñ: " + recipe.fat + " –≥ ‚Ä¢ –£: " + recipe.carbs + " –≥";

      modalIngredientsListEl.innerHTML = "";
      for (var i = 0; i < recipe.ingredients.length; i++) {
        var ing = recipe.ingredients[i];
        var li = document.createElement("li");
        li.innerHTML = ing.name + " ‚Äî " + ing.amount + " " + ing.unit;
        modalIngredientsListEl.appendChild(li);
      }

      modalStepsListEl.innerHTML = "";
      for (var j = 0; j < recipe.steps.length; j++) {
        var st = recipe.steps[j];
        var li2 = document.createElement("li");
        li2.innerHTML = st;
        modalStepsListEl.appendChild(li2);
      }

      recipeModalEl.classList.add("active");
    }
    function closeRecipeModal() {
      recipeModalEl.classList.remove("active");
    }

    modalCloseBtn.onclick = closeRecipeModal;
    recipeModalEl.onclick = function (e) {
      if (e.target === recipeModalEl ||
          (e.target && e.target.classList && e.target.classList.contains("modal-backdrop"))) {
        closeRecipeModal();
      }
    };

    function getRandomRecipe() {
      var idx = Math.floor(Math.random() * RECIPES.length);
      return RECIPES[idx];
    }

    function createRecipeCard(r) {
      var card = document.createElement("article");
      card.className = "recipe-card";
      card.innerHTML =
        '<div class="recipe-type">' + r.type + "</div>" +
        '<div class="recipe-title">' + r.title + "</div>" +
        '<div class="recipe-meta">' +
          "<span>" + r.kcal + " –∫–∫–∞–ª</span>" +
          '<span class="recipe-tag">' + (r.tag || "–ü–æ–ª–µ–∑–Ω–æ–µ –ü–ü") + "</span>" +
        "</div>" +
        '<div class="recipe-macros">' +
          "<span>–ë: " + r.protein + " –≥</span>" +
          "<span>–ñ: " + r.fat + " –≥</span>" +
          "<span>–£: " + r.carbs + " –≥</span>" +
        "</div>";
      card.recipeData = r;
      card.onclick = function () {
        openRecipeModal(card.recipeData);
      };
      return card;
    }

    var recipesBatchSize = 4;

    function renderRecipes(append) {
      if (!append) {
        recipesListEl.innerHTML = "";
      }
      for (var i = 0; i < recipesBatchSize; i++) {
        var r = getRandomRecipe();
        var card = createRecipeCard(r);
        recipesListEl.appendChild(card);
      }
    }

    recipesRefreshBtn.onclick = function () {
      renderRecipes(true);
    };

    // ==== –ú–ò–ö–†–û–î–í–ò–ñ–ï–ù–ò–Ø ====
    function getRandomMicroMoves(count) {
      var pool = MICRO_MOVES.slice();
      var selected = [];
      while (pool.length && selected.length < count) {
        var idx = Math.floor(Math.random() * pool.length);
        var item = pool.splice(idx, 1)[0];
        selected.push(item);
      }
      return selected;
    }

    function renderMicroMoves() {
      microListEl.innerHTML = "";
      var items = getRandomMicroMoves(4);
      for (var i = 0; i < items.length; i++) {
        var m = items[i];
        var card = document.createElement("div");
        card.className = "micro-card";
        card.innerHTML =
          '<div>' +
            '<div class="micro-title">' + m.title + '</div>' +
            '<div class="micro-meta">' + m.meta + '</div>' +
          '</div>' +
          '<button class="micro-done-toggle">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>';
        (function (button) {
          button.onclick = function () {
            if (button.classList.contains("done")) {
              button.classList.remove("done");
              button.innerHTML = "–í—ã–ø–æ–ª–Ω–µ–Ω–æ";
            } else {
              button.classList.add("done");
              button.innerHTML = "–ì–æ—Ç–æ–≤–æ";
            }
          };
        })(card.querySelector(".micro-done-toggle"));
        microListEl.appendChild(card);
      }
    }

    microRefreshBtn.onclick = renderMicroMoves;

    // ==== –î–ù–ï–í–ù–ò–ö ====
    function loadDiary() {
      var raw = getStorage(STORAGE_KEYS.DIARY);
      if (!raw) return [];
      try {
        var arr = JSON.parse(raw);
        if (Object.prototype.toString.call(arr) === "[object Array]") return arr;
        return [];
      } catch (e) { return []; }
    }
    function saveDiary(entries) {
      setStorage(STORAGE_KEYS.DIARY, JSON.stringify(entries));
    }

    var diaryEntries = loadDiary();

    function renderDiary() {
      diaryListEl.innerHTML = "";
      if (!diaryEntries.length) return;
      var sorted = diaryEntries.slice().sort(function (a, b) {
        return new Date(b.date) - new Date(a.date);
      });
      for (var i = 0; i < sorted.length; i++) {
        var entry = sorted[i];
        var item = document.createElement("article");
        item.className = "diary-item";
        item.innerHTML =
          '<div class="diary-item-header">' +
            '<div class="diary-title">' + (entry.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è") + '</div>' +
            '<div class="diary-date">' + formatDateTime(entry.date) + '</div>' +
          '</div>' +
          '<div class="diary-text">' + entry.text + '</div>';
        diaryListEl.appendChild(item);
      }
    }

    diarySaveBtn.onclick = function () {
      var title = diaryTitleInputEl.value.trim();
      var text = diaryTextInputEl.value.trim();
      if (!text && !title) return;
      var entry = {
        id: Date.now(),
        title: title || "–ú–æ–π –¥–µ–Ω—å",
        text: text || "–ó–∞–ø–∏—Å—å –±–µ–∑ —Ç–µ–∫—Å—Ç–∞",
        date: new Date().toISOString()
      };
      diaryEntries.push(entry);
      saveDiary(diaryEntries);
      diaryTitleInputEl.value = "";
      diaryTextInputEl.value = "";
      renderDiary();
    };

    // ==== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====
    renderWeightGraph();
    renderMeasures();
    syncWaterProgress();
    syncCaloriesProgress();
    renderRecipes(false);
    renderMicroMoves();
    renderDiary();
    updateProfileFromUI(false);
  </script>
</body>
</html>
